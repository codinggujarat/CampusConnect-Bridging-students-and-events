{% extends "sidebar.html" %}
{% block title %}Dashboard{% endblock %}


{% block nav_bar %}
<nav class="nav navbar navbar-expand-lg bg-white navbar-light iq-navbar">
    <div class="container-fluid navbar-inner">
        <a href="/admin-dashboard" class="navbar-brand">
            <!--Logo start-->
            <div class="logo-main">
                <div class="logo-normal">

                </div>
                <div class="logo-mini">

                </div>
            </div>
            <!--logo End-->
            <h4 class="logo-title">Campus Connect</h4>
        </a>
        <div class="sidebar-toggle bg-black" data-toggle="sidebar" data-active="true">
            <i class="icon ">
                <svg width="20px" class="icon-20" viewBox="0 0 24 24">
                    <path fill="currentColor"
                        d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" />
                </svg>
            </i>
        </div>
        <div class="input-group search-input mt-5">

        </div>
    </div>
</nav>
{% endblock %}

{% block main_bar %}
<div class="position-relative iq-banner">
    <div class="iq-navbar-header" style="height: 250px;">
        <div class="container-fluid iq-container">
            <div class="row">
                <div class="col-md-12">
                    <div class="flex-wrap d-flex justify-content-between align-items-center  ">
                        <div>
                            <h1>CampusConnect - Bridging students and events</h1>
                            <p>Connecting students with campus events, opportunities, and experiences in one place.</p>
                        </div>
                        <div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="iq-header-img h-70 ">
            <img src="/static/banner/hero.jpg" alt="header"
                class="theme-color-default-img img-fluid w-100 h-100 animated-scaleX">
        </div>
    </div>
</div>
{% endblock %}


{% block content %}
<div class="conatiner-fluid content-inner mt-5 py-0">
    <div>
        <div class="row">
            <div class="col-lg-4 col-md-6">
                <div class="card bg-white">
                    <div class="card-body">
                        <div class="text-left">Total Students </div>
                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <div>
                                <h2 class="counter">{{ total_students }}</h2>
                            </div>
                            <div class="border  bg-warning rounded p-3">

                                <svg class="icon-20" width="20" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                        d="M11.9849 15.3462C8.11731 15.3462 4.81445 15.931 4.81445 18.2729C4.81445 20.6148 8.09636 21.2205 11.9849 21.2205C15.8525 21.2205 19.1545 20.6348 19.1545 18.2938C19.1545 15.9529 15.8735 15.3462 11.9849 15.3462Z"
                                        stroke="white" stroke-width="1.5" stroke-linecap="round"
                                        stroke-linejoin="round"></path>
                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                        d="M11.9849 12.0059C14.523 12.0059 16.5801 9.94779 16.5801 7.40969C16.5801 4.8716 14.523 2.81445 11.9849 2.81445C9.44679 2.81445 7.3887 4.8716 7.3887 7.40969C7.38013 9.93922 9.42394 11.9973 11.9525 12.0059H11.9849Z"
                                        stroke="white" stroke-width="1.42857" stroke-linecap="round"
                                        stroke-linejoin="round"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="progress bg-soft-info shadow-none w-100" style="height: 6px">
                                <div class="progress-bar bg-info" data-toggle="progress-bar" role="progressbar"
                                    aria-valuenow="{{ total_students  }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="card bg-white">
                    <div class="card-body">
                        <div class="text-left">Total Students Present</div>
                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <div>
                                <h2 class="counter">{{ total_present }}</h2>
                            </div>
                            <div class="border  bg-info rounded p-3">

                                <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" fill="none"
                                    viewBox="0 0 24 24" stroke="white">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M5 10l7-7m0 0l7 7m-7-7v18" />
                                </svg>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="progress bg-soft-info shadow-none w-100" style="height: 6px">
                                <div class="progress-bar bg-info" data-toggle="progress-bar" role="progressbar"
                                    aria-valuenow="{{ total_present }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="card bg-white">
                    <div class="card-body">
                        <div class="text-left">Total Students Absent</div>
                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <div>
                                <h2 class="counter">{{ total_absent }}</h2>
                            </div>
                            <div class="border bg-danger rounded p-3">
                                <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" fill="none"
                                    viewBox="0 0 24 24" stroke="white">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                                </svg>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="progress bg-soft-danger shadow-none w-100" style="height: 6px">
                                <div class="progress-bar bg-danger" data-toggle="progress-bar" role="progressbar"
                                    aria-valuenow="{{ total_absent }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                {% set colors = ['bg-soft-primary', 'bg-soft-success', 'bg-soft-danger', 'bg-soft-warning', 'bg-soft-info', 'bg-soft-secondary'] %}
                {% for sem, stats in sem_stats.items() %}
                <div class="col-lg-4 col-md-6">
                    <div class="card bg-white">
                        <div class="card-body">
                            <h6 class="pb-2">Semester {{ sem }}</h6>
                            <div class="d-flex justify-content-between align-items-center">

                                <!-- Different background color for each semester -->
                                <div class="{{ colors[(loop.index0) % 6] }}  rounded p-3">
                                    <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                    </svg>
                                </div>

                                <div class="text-center">
                                    Present:
                                    <h2 class="counter">{{ stats.present }}</h2>
                                </div>
                                <div class="text-center">
                                    Absent:
                                    <h2 class="counter">{{ stats.absent }}</h2>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <div class="row">
                <div class="row">
                    <div class="col-md-3">
                        <div class="card bg-soft-primary">
                            <div class="card-body">
                                <div class="d-flex flex-column align-items-between">
                                    <div>
                                        <div class="d-flex">
                                            <div class="bg-primary text-white p-3 rounded">
                                                <svg class="icon-25" width="25" viewBox="0 0 24 24" fill="none"
                                                    xmlns="http://www.w3.org/2000/svg">
                                                    <path
                                                        d="M21.6389 14.3957H17.5906C16.1042 14.3948 14.8993 13.1909 14.8984 11.7045C14.8984 10.218 16.1042 9.01409 17.5906 9.01318H21.6389"
                                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                                        stroke-linejoin="round"></path>
                                                    <path d="M18.049 11.6429H17.7373" stroke="currentColor"
                                                        stroke-width="1.5" stroke-linecap="round"
                                                        stroke-linejoin="round"></path>
                                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                                        d="M7.74766 3H16.3911C19.2892 3 21.6388 5.34951 21.6388 8.24766V15.4247C21.6388 18.3229 19.2892 20.6724 16.3911 20.6724H7.74766C4.84951 20.6724 2.5 18.3229 2.5 15.4247V8.24766C2.5 5.34951 4.84951 3 7.74766 3Z"
                                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                                        stroke-linejoin="round"></path>
                                                    <path d="M7.03516 7.5382H12.4341" stroke="currentColor"
                                                        stroke-width="1.5" stroke-linecap="round"
                                                        stroke-linejoin="round"></path>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <span>Total Amount Paid</span>
                                        <div>
                                            <h3 class="counter" id="totalAmount"></h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 ">
                        <div class="card bg-soft-success">
                            <div class="card-body">
                                <div class="d-flex flex-column align-items-between">
                                    <div>
                                        <div class="d-flex">
                                            <div class="bg-success text-white p-3 rounded">
                                                <svg class="icon-25" xmlns="http://www.w3.org/2000/svg" width="25px"
                                                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <span>Total Students</span>
                                        <div>
                                            <h3 class="counter" id="totalStudents"></h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-soft-info">
                            <div class="card-body">
                                <div class="d-flex flex-column align-items-between">
                                    <div>
                                        <div class="d-flex">
                                            <div class="bg-info text-white p-3 rounded">
                                                <svg class="icon-25" xmlns="http://www.w3.org/2000/svg" width="25px"
                                                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <span>Paid Students</span>
                                        <div>
                                            <h3 class="counter" id="paidStudents"></h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-soft-warning">
                            <div class="card-body">
                                <div class="d-flex flex-column align-items-between">
                                    <div>
                                        <div class="d-flex">
                                            <div class="bg-warning text-white p-3 rounded">
                                                <svg class="icon-25" xmlns="http://www.w3.org/2000/svg" width="25px"
                                                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <span>Total Amount Collected (₹)</span>
                                        <div>
                                            <h3 class="counter" id="totalAmountCollected"></h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-soft-secondary">
                            <div class="card-body">
                                <div class="d-flex flex-column align-items-between">
                                    <div>
                                        <div class="d-flex">
                                            <div class="bg-secondary text-white p-3 rounded">
                                                <svg class="icon-25" xmlns="http://www.w3.org/2000/svg" width="25px"
                                                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <span>Refunded Students</span>
                                        <div>
                                            <h3 class="counter" id="refundedStudents"></h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-3">
                        <div class="card bg-soft-danger">
                            <div class="card-body">
                                <div class="d-flex flex-column align-items-between">
                                    <div>
                                        <div class="d-flex">
                                            <div class="bg-danger text-white p-3 rounded">
                                                <svg class="icon-25" xmlns="http://www.w3.org/2000/svg" width="25px"
                                                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <span>Total Amount Refunded (₹)</span>
                                        <div>
                                            <h3 class="counter" id="totalAmountRefunded"></h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>



                <div class="col-lg-12 " style="height: 100vh;">
                    <div class="card bg-white">
                        <canvas id="semesterChart"></canvas>
                    </div>
                </div>

            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    if (document.querySelector("#ethernet-chart-01")) {
        const options = {
            series: [{
                name: "Frontend Time",
                data: [2.1, 2.5, 2.0, 2.3, 2.14, 2.2, 2.15]
            }],
            colors: ["#3a57e8"],
            chart: {
                height: 60,
                type: 'line',
                sparkline: { enabled: true },
                zoom: { enabled: false },
                toolbar: { show: false },
            },
            dataLabels: { enabled: false },
            stroke: { curve: 'smooth', width: 3 },
            legend: { show: false },
            grid: { show: false },
            xaxis: { labels: { show: false } },
            yaxis: { labels: { show: false } }
        };

        var chart = new ApexCharts(document.querySelector("#ethernet-chart-01"), options);
        chart.render();

        // Optional: update color dynamically
        document.addEventListener('ColorChange', (e) => {
            chart.updateOptions({ colors: [e.detail.detail1] });
        });
    }
</script>

<script>
    fetch("/chart_data")
        .then(res => res.json())
        .then(data => {
            const ctx = document.getElementById('semesterChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ["Sem 1", "Sem 2", "Sem 3", "Sem 4", "Sem 5", "Sem 5"],
                    datasets: [{
                        label: 'Registrations',
                        data: data.values,
                        backgroundColor: [
                            'rgba(108, 117, 125, 0.2)',
                            'rgba(25, 135, 84, 0.2)',
                            'rgba(255, 193, 7, 0.2)',
                            'rgba(13, 202, 240, 0.2)',
                            'rgba(13, 110, 253, 0.2)',
                            'rgba(33, 37, 41, 0.2)'
                        ],
                        borderColor: '#fff',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Event Registrations by Semester',
                            font: { size: 20, weight: 'bold' },
                            color: '#444',
                            padding: { top: 20, left: 20, bottom: 0 },
                            align: 'start'
                        },
                        legend: {
                            display: true,
                            labels: {
                                color: '#333',
                                font: { size: 14 }
                            }
                        },
                        tooltip: {
                            backgroundColor: '#333',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            cornerRadius: 8,
                            padding: 10
                        }
                    },
                    layout: {
                        padding: {
                            left: 30, // space from chart edge
                            right: 10,
                            top: 10,
                            bottom: 10
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#444',
                                font: { size: 14 }
                            },
                            grid: {
                                color: '#ccc'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#444',
                                font: { size: 14 }
                            },
                            grid: {
                                display: true
                            }
                        }
                    }
                }
            });
        });
</script>
<!-- JS to fetch numbers -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        fetch("/dashboard_data")
            .then(res => res.json())
            .then(data => {
                document.getElementById('totalStudents').innerText = data.total_students || 0;
                document.getElementById('paidStudents').innerText = data.paid_not_refunded || 0;
                document.getElementById('totalAmountCollected').innerText = data.total_amount_collected || 0;
                document.getElementById('refundedStudents').innerText = data.refunded_count || 0;
                document.getElementById('totalAmountRefunded').innerText = data.total_amount_refunded || 0;
                document.getElementById('totalAmount').innerText = data.total_amount_collected || 0;
            });
    });
</script>
{% endblock %}