{% extends "sidebar.html" %}
{% block title %}Dashboard{% endblock %}


{% block nav_bar %}
<nav class="nav navbar navbar-expand-lg bg-white navbar-light iq-navbar">
    <div class="container-fluid navbar-inner">
        <a href="/admin-dashboard" class="navbar-brand">
            <!--Logo start-->
            <div class="logo-main">
                <div class="logo-normal">

                </div>
                <div class="logo-mini">

                </div>
            </div>
            <!--logo End-->
            <h4 class="logo-title">Campus Connect</h4>
        </a>
        <div class="sidebar-toggle bg-black" data-toggle="sidebar" data-active="true">
            <i class="icon " >
                <svg width="20px" class="icon-20" viewBox="0 0 24 24">
                    <path fill="currentColor"
                        d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" />
                </svg>
            </i>
        </div>
        <div class="input-group search-input mt-5">
          
        </div>
    </div>
</nav>
{% endblock %}

{% block main_bar %}
<div class="position-relative iq-banner">
    <div class="iq-navbar-header" style="height: 250px;">
        <div class="container-fluid iq-container">
            <div class="row">
                <div class="col-md-12">
                    <div class="flex-wrap d-flex justify-content-between align-items-center  ">
                        <div>
                            <h1>CampusConnect - Bridging students and events</h1>
                            <p>Connecting students with campus events, opportunities, and experiences in one place.</p>
                        </div>
                        <div>
                           
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="iq-header-img h-70 ">
            <img src="/static/banner/hero.jpg" alt="header"
                class="theme-color-default-img img-fluid w-100 h-100 animated-scaleX">
        </div>
    </div>
</div>
{% endblock %}


{% block content %}
<div class="conatiner-fluid content-inner mt-5 py-0">
    <div>
        <div class="row">
            <div class="col-lg-4 col-md-6">
                <div class="card bg-white">
                    <div class="card-body">
                        <div class="text-left">Total Students </div>
                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <div>
                                <h2 class="counter">{{ total_students  }}</h2>
                            </div>
                            <div class="border  bg-warning rounded p-3">

                                <svg class="icon-20" width="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                        d="M11.9849 15.3462C8.11731 15.3462 4.81445 15.931 4.81445 18.2729C4.81445 20.6148 8.09636 21.2205 11.9849 21.2205C15.8525 21.2205 19.1545 20.6348 19.1545 18.2938C19.1545 15.9529 15.8735 15.3462 11.9849 15.3462Z"
                                        stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                        d="M11.9849 12.0059C14.523 12.0059 16.5801 9.94779 16.5801 7.40969C16.5801 4.8716 14.523 2.81445 11.9849 2.81445C9.44679 2.81445 7.3887 4.8716 7.3887 7.40969C7.38013 9.93922 9.42394 11.9973 11.9525 12.0059H11.9849Z"
                                        stroke="white" stroke-width="1.42857" stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="progress bg-soft-info shadow-none w-100" style="height: 6px">
                                <div class="progress-bar bg-info" data-toggle="progress-bar" role="progressbar"
                                    aria-valuenow="{{ total_students  }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="card bg-white">
                    <div class="card-body">
                        <div class="text-left">Total Students Present</div>
                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <div>
                                <h2 class="counter">{{ total_present }}</h2>
                            </div>
                            <div class="border  bg-info rounded p-3">
            
                                <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" fill="none" viewBox="0 0 24 24"
                                    stroke="white">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M5 10l7-7m0 0l7 7m-7-7v18" />
                                </svg>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="progress bg-soft-info shadow-none w-100" style="height: 6px">
                                <div class="progress-bar bg-info" data-toggle="progress-bar" role="progressbar"
                                    aria-valuenow="{{ total_present }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="card bg-white">
                    <div class="card-body">
                        <div class="text-left">Total Students Absent</div>
                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <div>
                                <h2 class="counter">{{ total_absent }}</h2>
                            </div>
                            <div class="border bg-danger rounded p-3">
                                <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" fill="none"
                                    viewBox="0 0 24 24" stroke="white">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                                </svg>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="progress bg-soft-danger shadow-none w-100" style="height: 6px">
                                <div class="progress-bar bg-danger" data-toggle="progress-bar" role="progressbar"
                                    aria-valuenow="{{ total_absent }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                {% for sem, stats in sem_stats.items() %}
                <div class="col-lg-4 col-md-6 ">
                    <div class="card bg-white">
                        <div class="card-body ">
                            <h6 class=" pb-2">Semester {{ sem }}</h6>
                            <div class="d-flex  justify-content-between align-items-center">
                                <div class="bg-gray text-white rounded p-3">
                                    <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                    </svg>
                                </div>
                                <div class="text-center">
                                    Present:
                                    <h2 class="counter">{{ stats.present }}</h2>
                                </div>
                                <div class="text-center">
                                    Absent:
                                    <h2 class="counter">{{ stats.absent }}</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <div class="card bg-soft-success"
                        style="box-shadow: rgba(50, 50, 93, 0.25) 0px 30px 60px -12px inset, rgba(0, 0, 0, 0.3) 0px 18px 36px -18px inset;">
                        <canvas id="semesterChart" id="extrachart"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class=" bg-soft-success rounded p-3">
                                    <svg class="icon-35" xmlns="http://www.w3.org/2000/svg" width="35px" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 8h6m-5 0a3 3 0 110 6H9l3 3m-3-6h6m6 1a9 9 0 11-18 0 9 9 0 0118 0z">
                                        </path>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-success mb-0">Total Amount Paid</p>
                                    <h1 id="totalAmount" class="text-success counter"></h1>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    fetch("/chart_data")
        .then(res => res.json())
        .then(data => {
            const ctx = document.getElementById('semesterChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Registrations',
                        data: data.values,
                        backgroundColor: [
                            'rgba(108, 117, 125, 1)',
                            'rgba(25, 135, 84, 1)',
                            'rgba(255, 193, 7, 1)',
                            'rgba(13, 202, 240, 1)',
                            'rgba(13, 110, 253, 1)',
                            'rgba(33, 37, 41, 1)'
                        ],
                        borderColor: '#fff',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Event Registrations by Semester',
                            font: { size: 20, weight: 'bold' },
                            color: '#444',
                            padding: { top: 20, left: 20, bottom: 0 },
                            align: 'start'
                        },
                        legend: {
                            display: true,
                            labels: {
                                color: '#333',
                                font: { size: 14 }
                            }
                        },
                        tooltip: {
                            backgroundColor: '#333',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            cornerRadius: 8,
                            padding: 10
                        }
                    },
                    layout: {
                        padding: {
                            left: 30, // space from chart edge
                            right: 10,
                            top: 10,
                            bottom: 10
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#444',
                                font: { size: 14 }
                            },
                            grid: {
                                color: '#ccc'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#444',
                                font: { size: 14 }
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        });
</script>

<!-- total amount -->
<script>
    function formatAmount(amount) {
        if (amount >= 100000) {
            // Convert to lakhs
            return `₹${(amount / 100000).toFixed(1)}L`;
        } else if (amount >= 1000) {
            // Convert to thousands
            return `₹${(amount / 1000).toFixed(1)}K`;
        } else {
            // Normal amount
            return `₹${amount}`;
        }
    }

    fetch('/dashboard_data')
        .then(response => response.json())
        .then(data => {
            document.getElementById('totalAmount').textContent = formatAmount(data.total_amount);
        });
</script>


<!-- total amount end-->
{% endblock %}