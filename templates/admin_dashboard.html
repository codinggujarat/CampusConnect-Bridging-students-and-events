{% extends "sidebar.html" %}
{% block title %}Dashboard{% endblock %}


{% block nav_bar %}
<nav class="nav navbar navbar-expand-lg bg-white navbar-light iq-navbar">
    <div class="container-fluid navbar-inner">
        <a href="/admin-dashboard" class="navbar-brand">
            <!--Logo start-->
            <div class="logo-main">
                <div class="logo-normal">

                </div>
                <div class="logo-mini">

                </div>
            </div>
            <!--logo End-->
            <h4 class="logo-title">Campus Connect</h4>
        </a>
        <div class="sidebar-toggle bg-black" data-toggle="sidebar" data-active="true">
            <i class="icon ">
                <svg width="20px" class="icon-20" viewBox="0 0 24 24">
                    <path fill="currentColor"
                        d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" />
                </svg>
            </i>
        </div>
        <div class="input-group search-input mt-5">

        </div>
    </div>
</nav>
{% endblock %}

{% block main_bar %}
<div class="position-relative iq-banner">
    <div class="iq-navbar-header" style="height: 250px;">
        <div class="container-fluid iq-container">
            <div class="row">
                <div class="col-md-12">
                    <div class="flex-wrap d-flex justify-content-between align-items-center  ">
                        <div>
                            <h1>CampusConnect - Bridging students and events</h1>
                            <p>Connecting students with campus events, opportunities, and experiences in one place.</p>
                        </div>
                        <div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="iq-header-img h-70 ">
            <img src="/static/banner/hero.jpg" alt="header"
                class="theme-color-default-img img-fluid w-100 h-100 animated-scaleX">
        </div>
    </div>
</div>
{% endblock %}


{% block content %}
<div class="conatiner-fluid content-inner mt-5 py-0">
    <div>
        <div class="row">

            <div class="col-lg-4 col-md-6">
                <div class="card bg-white">
                    <div class="card-body">
                        <div class="text-left text-uppercase">Total Students </div>
                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <div>
                                <h2 class="counter">{{ total_students }}</h2>
                            </div>
                            <div class="border  bg-warning rounded p-3">

                                <svg class="icon-20" width="20" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                        d="M11.9849 15.3462C8.11731 15.3462 4.81445 15.931 4.81445 18.2729C4.81445 20.6148 8.09636 21.2205 11.9849 21.2205C15.8525 21.2205 19.1545 20.6348 19.1545 18.2938C19.1545 15.9529 15.8735 15.3462 11.9849 15.3462Z"
                                        stroke="white" stroke-width="1.5" stroke-linecap="round"
                                        stroke-linejoin="round"></path>
                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                        d="M11.9849 12.0059C14.523 12.0059 16.5801 9.94779 16.5801 7.40969C16.5801 4.8716 14.523 2.81445 11.9849 2.81445C9.44679 2.81445 7.3887 4.8716 7.3887 7.40969C7.38013 9.93922 9.42394 11.9973 11.9525 12.0059H11.9849Z"
                                        stroke="white" stroke-width="1.42857" stroke-linecap="round"
                                        stroke-linejoin="round"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="progress bg-soft-info shadow-none w-100" style="height: 6px">
                                <div class="progress-bar bg-info" data-toggle="progress-bar" role="progressbar"
                                    aria-valuenow="{{ total_students  }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="card bg-white">
                    <div class="card-body">
                        <div class="text-left text-uppercase">Total Students Present</div>
                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <div>
                                <h2 class="counter">{{ total_present }}</h2>
                            </div>
                            <div class="border  bg-info rounded p-3">

                                <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" fill="none"
                                    viewBox="0 0 24 24" stroke="white">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M5 10l7-7m0 0l7 7m-7-7v18" />
                                </svg>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="progress bg-soft-info shadow-none w-100" style="height: 6px">
                                <div class="progress-bar bg-info" data-toggle="progress-bar" role="progressbar"
                                    aria-valuenow="{{ total_present }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-6">
                <div class="card bg-white">
                    <div class="card-body">
                        <div class="text-left text-uppercase">Total Students Absent</div>
                        <div class="d-flex align-items-center justify-content-between mt-3">
                            <div>
                                <h2 class="counter">{{ total_absent }}</h2>
                            </div>
                            <div class="border bg-danger rounded p-3">
                                <svg class="icon-20" xmlns="http://www.w3.org/2000/svg" width="20px" fill="none"
                                    viewBox="0 0 24 24" stroke="white">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                                </svg>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="progress bg-soft-danger shadow-none w-100" style="height: 6px">
                                <div class="progress-bar bg-danger" data-toggle="progress-bar" role="progressbar"
                                    aria-valuenow="{{ total_absent }}" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% set colors = ['bg-soft-primary', 'bg-soft-success', 'bg-soft-danger', 'bg-soft-warning',
            'bg-soft-info', 'bg-soft-secondary'] %}
            {% for sem, stats in sem_stats.items() %}
            <div class="col-lg-4 col-md-6">
                <div class="card">
                    <div class="card-body">
                        <p class="mb-2 text-uppercase">Semester {{ sem }}</p>
                        <div class="mt-3">
                            <div class="pb-3">
                                <div class="d-flex align-items-center justify-content-between mb-2">
                                    <p class="mb-0 text-uppercase"> Present:</p>
                                    <h4>{{ stats.present }}</h4>
                                </div>
                                <div class="progress bg-soft-info shadow-none w-100" style="height: 10px">
                                    <div class="progress-bar bg-info" data-toggle="progress-bar" role="progressbar"
                                        aria-valuenow="{{ stats.present }}" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                                <div class="d-flex align-items-center justify-content-between mb-2">
                                    <p class="mb-0 text-uppercase"> Absent:</p>
                                    <h4>{{ stats.absent }}</h4>
                                </div>
                                <div class="progress bg-soft-danger shadow-none w-100" style="height: 10px">
                                    <div class="progress-bar bg-danger" data-toggle="progress-bar" role="progressbar"
                                        aria-valuenow="{{ stats.absent }}" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="row">

            <div class="col-md-4">
                <div class="card bg-white">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="bg-soft-primary text-black p-3 rounded">
                                <svg class="icon-25" width="25" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M21.6389 14.3957H17.5906C16.1042 14.3948 14.8993 13.1909 14.8984 11.7045C14.8984 10.218 16.1042 9.01409 17.5906 9.01318H21.6389"
                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                        stroke-linejoin="round"></path>
                                    <path d="M18.049 11.6429H17.7373" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                        d="M7.74766 3H16.3911C19.2892 3 21.6388 5.34951 21.6388 8.24766V15.4247C21.6388 18.3229 19.2892 20.6724 16.3911 20.6724H7.74766C4.84951 20.6724 2.5 18.3229 2.5 15.4247V8.24766C2.5 5.34951 4.84951 3 7.74766 3Z"
                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                        stroke-linejoin="round"></path>
                                    <path d="M7.03516 7.5382H12.4341" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                            </div>
                            <div class="mt-3">
                                <div>
                                    <h3 class="counter text-end" id="totalAmount"></h3>
                                </div>
                                <span class="text-uppercase">Total Amount Paid</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card bg-white">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="bg-soft-info text-black p-3 rounded">
                                  <svg class="icon-25" width="25" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M21.6389 14.3957H17.5906C16.1042 14.3948 14.8993 13.1909 14.8984 11.7045C14.8984 10.218 16.1042 9.01409 17.5906 9.01318H21.6389"
                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                        stroke-linejoin="round"></path>
                                    <path d="M18.049 11.6429H17.7373" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                        d="M7.74766 3H16.3911C19.2892 3 21.6388 5.34951 21.6388 8.24766V15.4247C21.6388 18.3229 19.2892 20.6724 16.3911 20.6724H7.74766C4.84951 20.6724 2.5 18.3229 2.5 15.4247V8.24766C2.5 5.34951 4.84951 3 7.74766 3Z"
                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                        stroke-linejoin="round"></path>
                                    <path d="M7.03516 7.5382H12.4341" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>

                            </div>
                            <div class="mt-3">
                                <div>
                                    <h3 class="counter text-end" id="paidStudents"></h3>
                                </div>
                                <span class="text-uppercase">Paid Students</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card bg-white">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="bg-soft-secondary text-black p-3 rounded">
                                  <svg class="icon-25" width="25" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M21.6389 14.3957H17.5906C16.1042 14.3948 14.8993 13.1909 14.8984 11.7045C14.8984 10.218 16.1042 9.01409 17.5906 9.01318H21.6389"
                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                        stroke-linejoin="round"></path>
                                    <path d="M18.049 11.6429H17.7373" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                        d="M7.74766 3H16.3911C19.2892 3 21.6388 5.34951 21.6388 8.24766V15.4247C21.6388 18.3229 19.2892 20.6724 16.3911 20.6724H7.74766C4.84951 20.6724 2.5 18.3229 2.5 15.4247V8.24766C2.5 5.34951 4.84951 3 7.74766 3Z"
                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                        stroke-linejoin="round"></path>
                                    <path d="M7.03516 7.5382H12.4341" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                            </div>

                            <div class="mt-3">
                                <div>
                                    <h3 class="counter text-end" id="refundedStudents"></h3>
                                </div>
                                <span class="text-uppercase">Refunded Students</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card bg-white ">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="bg-soft-warning text-black p-3 rounded">
                                  <svg class="icon-25" width="25" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M21.6389 14.3957H17.5906C16.1042 14.3948 14.8993 13.1909 14.8984 11.7045C14.8984 10.218 16.1042 9.01409 17.5906 9.01318H21.6389"
                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                        stroke-linejoin="round"></path>
                                    <path d="M18.049 11.6429H17.7373" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                        d="M7.74766 3H16.3911C19.2892 3 21.6388 5.34951 21.6388 8.24766V15.4247C21.6388 18.3229 19.2892 20.6724 16.3911 20.6724H7.74766C4.84951 20.6724 2.5 18.3229 2.5 15.4247V8.24766C2.5 5.34951 4.84951 3 7.74766 3Z"
                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                        stroke-linejoin="round"></path>
                                    <path d="M7.03516 7.5382H12.4341" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                            </div>
                            <div class="mt-3">
                                <div>
                                    <h3 class="counter text-end" id="totalAmountCollected"></h3>
                                </div>
                                <span class="text-uppercase">Total Amount Collected (₹)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card bg-white">
                    <div class="card-body">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="bg-soft-danger text-black p-3 rounded">
                                  <svg class="icon-25" width="25" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M21.6389 14.3957H17.5906C16.1042 14.3948 14.8993 13.1909 14.8984 11.7045C14.8984 10.218 16.1042 9.01409 17.5906 9.01318H21.6389"
                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                        stroke-linejoin="round"></path>
                                    <path d="M18.049 11.6429H17.7373" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round"></path>
                                    <path fill-rule="evenodd" clip-rule="evenodd"
                                        d="M7.74766 3H16.3911C19.2892 3 21.6388 5.34951 21.6388 8.24766V15.4247C21.6388 18.3229 19.2892 20.6724 16.3911 20.6724H7.74766C4.84951 20.6724 2.5 18.3229 2.5 15.4247V8.24766C2.5 5.34951 4.84951 3 7.74766 3Z"
                                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                        stroke-linejoin="round"></path>
                                    <path d="M7.03516 7.5382H12.4341" stroke="currentColor" stroke-width="1.5"
                                        stroke-linecap="round" stroke-linejoin="round"></path>
                                </svg>
                            </div>
                            <div class="mt-3">
                                <div>
                                    <h3 class="counter text-end" id="totalAmountRefunded"></h3>
                                </div>
                                <span class="text-uppercase">Total Amount Refunded (₹)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-12">
                <div class="mt-5 card p-4">
                    <h3 class="text-start  text-uppercase">Students & Family Members Overview</h3>

                    <div class="row mt-4">
                        <!-- Bar Chart -->
                        <div class="col-md-7">
                            <div class=" p-3 ">
                                <h5 class="text-start text-uppercase">Students & Family Members Per Semester
                                </h5>
                                <canvas id="studentsFamilyChart" height="180"></canvas>
                            </div>
                        </div>

                        <!-- Pie Chart -->
                        <div class="col-md-5">
                            <div class=" p-3 ">
                                <h5 class="text-start text-uppercase">Family Members Distribution</h5>
                                <canvas id="familyPieChart" height="180"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

</div>
<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Chart JS Script -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        fetch("/chart_data")
            .then(res => res.json())
            .then(data => {
                const ctxBar = document.getElementById("studentsFamilyChart").getContext("2d");
                const ctxPie = document.getElementById("familyPieChart").getContext("2d");

                if (!data.labels.length) {
                    ctxBar.font = "16px Arial";
                    ctxBar.fillText("No data available", 100, 80);
                    ctxPie.font = "16px Arial";
                    ctxPie.fillText("No data available", 80, 80);
                    return;
                }

                // 🎨 Bar Chart — Students + Family Members per Semester
                new Chart(ctxBar, {
                    type: "bar",
                    data: {
                        labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4', 'Sem 5', 'Sem 6'],
                        datasets: [
                            {
                                label: data.legend_students,
                                data: data.students,
                                backgroundColor: "rgba(54, 162, 235, 0.6)",
                                borderColor: "rgba(54, 162, 235, 1)",
                                borderWidth: 1
                            },
                            {
                                label: data.legend_family,
                                data: data.family_members,
                                backgroundColor: "rgba(255, 99, 132, 0.6)",
                                borderColor: "rgba(255, 99, 132, 1)",
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: "top" },
                            tooltip: { enabled: true }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { precision: 0 }
                            }
                        }
                    }
                });

                // 🎨 Pie Chart — Total Family Members per Semester
                new Chart(ctxPie, {
                    type: "pie",
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: "Family Members",
                            data: data.family_members,
                            backgroundColor: [
                                "rgba(255, 99, 132, 0.7)",
                                "rgba(54, 162, 235, 0.7)",
                                "rgba(255, 206, 86, 0.7)",
                                "rgba(75, 192, 192, 0.7)",
                                "rgba(153, 102, 255, 0.7)",
                                "rgba(255, 159, 64, 0.7)"
                            ],
                            borderColor: "#fff",
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: "bottom" },
                            tooltip: { enabled: true }
                        }
                    }
                });
            })
            .catch(err => console.error("Chart load error:", err));
    });
</script>

<!-- JS to fetch numbers -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        fetch("/dashboard_data")
            .then(res => res.json())
            .then(data => {
                document.getElementById('paidStudents').innerText = data.paid_not_refunded || 0;
                document.getElementById('totalAmountCollected').innerText = data.total_amount_collected || 0;
                document.getElementById('refundedStudents').innerText = data.refunded_count || 0;
                document.getElementById('totalAmountRefunded').innerText = data.total_amount_refunded || 0;
                document.getElementById('totalAmount').innerText = data.total_amount_collected || 0;
            });
    });
</script>
{% endblock %}